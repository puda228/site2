<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Задания</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 16px;
            color: var(--tg-theme-text-color, #000);
            background: var(--tg-theme-bg-color, #fff);
        }

        .task {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .task:hover {
            transform: scale(1.02);
        }

        .task.completed {
            opacity: 0.7;
        }

        .points {
            color: var(--tg-theme-hint-color, #999);
            font-size: 14px;
        }

        #totalPoints {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--tg-theme-bg-color, #fff);
            padding: 8px 16px;
            border-bottom: 1px solid var(--tg-theme-hint-color, #ddd);
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="totalPoints">Всего очков: 0</div>
    <div id="tasks" style="margin-top: 40px"></div>

    <script>
        let webapp = window.Telegram.WebApp;
        webapp.ready();
        webapp.expand();

        // Глобальные переменные
        window.userPoints = 0;
        window.completedTasks = [];

        // Задания
        const tasks = [
            { id: 1, title: "Простое задание", points: 10, description: "Выполните это простое задание для получения 10 очков" },
            { id: 2, title: "Задание средней сложности", points: 20, description: "Это задание немного сложнее, но даёт больше очков" },
            { id: 3, title: "Сложное задание", points: 30, description: "Сложное задание с максимальным количеством очков" }
        ];

        // Отображаем задания
        function renderTasks() {
            const tasksContainer = document.getElementById('tasks');
            tasksContainer.innerHTML = '';

            tasks.forEach(task => {
                const isCompleted = window.completedTasks.includes(task.id);
                const taskElement = document.createElement('div');
                taskElement.className = `task ${isCompleted ? 'completed' : ''}`;
                taskElement.innerHTML = `
                    <h3>${task.title}</h3>
                    <p>${task.description}</p>
                    <div class="points">+${task.points} очков</div>
                `;

                if (!isCompleted) {
                    taskElement.onclick = () => completeTask(task);
                }

                tasksContainer.appendChild(taskElement);
            });

            document.getElementById('totalPoints').textContent = `Всего очков: ${window.userPoints}`;
        }

        // Выполнение задания
        function completeTask(task) {
            try {
                if (!window.completedTasks.includes(task.id)) {
                    window.completedTasks.push(task.id);
                    window.userPoints += task.points;
                    saveProgress();
                    renderTasks();
                }
            } catch (e) {
                console.error('Ошибка при выполнении задания:', e);
                webapp.showPopup({
                    title: 'Ошибка',
                    message: 'Не удалось выполнить задание: ' + e.message
                });
            }
        }

        // Сохранение прогресса
        function saveProgress() {
            try {
                // Создаем строку запроса с данными
                const data = {
                    points: window.userPoints,
                    tasks: window.completedTasks
                };

                // Отправляем данные
                webapp.sendData(JSON.stringify(data));
                
                // Показываем уведомление
                webapp.showPopup({
                    title: 'Успех',
                    message: 'Прогресс сохранен!'
                });
            } catch (e) {
                console.error('Ошибка при сохранении:', e);
                webapp.showPopup({
                    title: 'Ошибка',
                    message: 'Не удалось сохранить прогресс: ' + e.message
                });
            }
        }

        // Инициализация
        renderTasks();
    </script>
</body>
</html>
