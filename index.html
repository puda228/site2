<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Manager</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 16px;
            color: var(--tg-theme-text-color, #000);
            background: var(--tg-theme-bg-color, #fff);
        }

        .task {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-info {
            flex-grow: 1;
        }

        .task-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .task-points {
            color: var(--tg-theme-hint-color, #999);
        }

        .complete-button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #fff);
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
        }

        .complete-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #total-points {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 16px;
            color: var(--tg-theme-text-color, #000);
        }
    </style>
</head>
<body>
    <div id="total-points">Всего очков: 0</div>
    <div id="tasks"></div>

    <script>
        const tg = window.Telegram.WebApp;
        
        // Инициализация
        tg.ready();
        tg.expand();

        // Задания
        const tasks = [
            { id: 1, title: "Первое задание", description: "Выполните первое задание", points: 10 },
            { id: 2, title: "Второе задание", description: "Выполните второе задание", points: 20 },
            { id: 3, title: "Третье задание", description: "Выполните третье задание", points: 30 },
        ];

        let userPoints = 0;
        let completedTasks = [];

        // Загрузка прогресса пользователя
        function loadProgress() {
            const savedPoints = localStorage.getItem('points');
            const savedTasks = localStorage.getItem('completed_tasks');
            
            if (savedPoints) {
                userPoints = parseInt(savedPoints);
            }
            
            if (savedTasks) {
                completedTasks = JSON.parse(savedTasks);
            }
            
            updateUI();
        }

        // Сохранение прогресса пользователя
        function saveProgress() {
            localStorage.setItem('points', userPoints.toString());
            localStorage.setItem('completed_tasks', JSON.stringify(completedTasks));
            
            // Отправляем данные в бот
            tg.sendData(JSON.stringify({
                points: userPoints,
                tasks: completedTasks
            }));
        }

        // Обновление интерфейса
        function updateUI() {
            document.getElementById('total-points').textContent = `Всего очков: ${userPoints}`;
            
            const tasksContainer = document.getElementById('tasks');
            tasksContainer.innerHTML = '';
            
            tasks.forEach(task => {
                const isCompleted = completedTasks.includes(task.id);
                
                const taskElement = document.createElement('div');
                taskElement.className = 'task';
                taskElement.innerHTML = `
                    <div class="task-info">
                        <div class="task-title">${task.title}</div>
                        <div class="task-description">${task.description}</div>
                        <div class="task-points">+${task.points} очков</div>
                    </div>
                    <button 
                        class="complete-button" 
                        onclick="completeTask(${task.id}, ${task.points})"
                        ${isCompleted ? 'disabled' : ''}
                    >
                        ${isCompleted ? 'Выполнено' : 'Выполнить'}
                    </button>
                `;
                
                tasksContainer.appendChild(taskElement);
            });
        }

        // Выполнение задания
        function completeTask(taskId, points) {
            if (!completedTasks.includes(taskId)) {
                completedTasks.push(taskId);
                userPoints += points;
                
                saveProgress();
                updateUI();
                
                // Показываем уведомление
                tg.showPopup({
                    title: 'Задание выполнено!',
                    message: `Вы получили +${points} очков`,
                    buttons: [{type: 'ok'}]
                });
            }
        }

        // Загружаем прогресс при запуске
        loadProgress();
    </script>
</body>
</html>
